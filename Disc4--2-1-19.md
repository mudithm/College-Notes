<h1>Discussion 4</h1>

---

<h4>Project 2A -- Races and Synchronization</h4>

  * `pthreads` library
  * `clock.gettime(2)` 
  * GCC atomic built-ins
  * `gnuplot(1)` 
      - Graphs, with file extension `.gp` 
  * __Deliverables:__
      - `Lab2_add.c` 
      - `Lab2_list.c` 
          + (For each part of the project)
      - `SortedList.h` Linked List Header
      - `SortedList.c` list implementation
      - CSV Files:
          + `Lab2_add.csv`
          + `Lab2_list.csv`
      - 9 Graphs
          + 5 for part 1
          + 4 for part 2
      - Makefiles:
          + `dist, clean`
          + `check` generates CSV
          + `graph` to generate the graphs

<h4>Part 1: <i>Adds to a shared variable</i></h4>

  * In `lab2_add`: 
      - `--threads=#` number of threads
      - `--iterations=#` number of times to run
  * To Start: 
      - set `long counter` to 0
      - use `clock.gettime` to get the initial timestamp for when the program starts
  * Action: 
      - start {#} of threads
      - each thread adds 1, subracts -1 from counter
  * Output:
      - default
          + Test name: `add-none`, 
          + # of threads, 
          + # of iterations, 
          + # of operations (# threads * # iterations * 2 (2 operations, adding and subtracting 1)), 
          + runtime (ns), 
          + avg time per op (ns),
          + Counter value (should be 0 if there are no synchronization issues)
  * Exit codes:
      - 0 on success
      - If errors (Except counter != 0)
          + use a nonzero exit code, as per the spec

---

<h4>Questions</h4>

  * 2.1.1
      - Threads 2, 4, 8, 12
      - Iterations: increasing factors of 10: 100, 1000, 10000, 100000
      - Pay attention to when counter starts failing
  * In extended add:
      - add `--yield`, which sets opt-yiled to 1
      - add-yield if this option is included
      - use add plotting script to plot
          + successful runs vs # of threads/iterations
              * lab2_add-1.gp
          + Add graph 2: 
              * time per operation vs # of iterations

---

<h4>new arg:</h4>

  * `--sync=m` (mutex lock)
      - pthread_mutex_init
      - pthread_mutex_lock
      - pthread_mutex_unlock
  * `--sync=s` (spin lock)
      - atomic builtins
  * `--sync=c` (compare and swap)
      - atomic builtins

---

<h4>Test Names</h4>

  * Default: `add-none` 
  * Only `--sync`: `add-m` / `add-s` / `add-c` 
  * Only `--yield`: `add-yield-none`
  * `--yield` and `--sync`: `add-yield-m/s/c` 

---

<h4>Part 2 <i>Linked List</i></h4>

  * Aafter implemetnig list methods, add yield calls in crit section of each
  * yield changes
  * yield=[idl]
  * none,i,

 <h4>Output</h4> 

   * test name
       - list-[yield]-[sync],
       - yield=--yield,
       - sync=--sync,
       - # of lists,
       - # of operations,
           + threads * iterations * 3
       - The rest of the output is the same
   * Catch and handle segfaults the normal way
   * Exits: 
       - 0 on success
       - 1 on bad arg
       - 2 on inconsistency
           + exit immediately with error code

---

<h4>Per operation cost adjust</h4>

  * Divide cost per iteration by avg search distance
  * Cost per iteration:
      - Total cost / (threads * iterations)
      - Avg search distance:
          + iterations / 4

compare final linked-list graph to final graph
